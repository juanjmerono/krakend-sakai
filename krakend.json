{
  "version": 2,
  "plugin": {
    "pattern": ".so",
    "folder": "./plugins/"
  },
  "timeout": "30000ms",
  "cache_ttl": "300s",
  "output_encoding": "json",
  "name": "CoolUserService",
  "extra_config": {
    "github.com/devopsfaith/krakend/transport/http/server/handler": {
      "name": ["serverPlugin"]
    }
  },	
  "endpoints": [
    {
      "endpoint": "api/get-token/{userEid}",
      "method": "POST",
      "extra_config": {
        "github.com/devopsfaith/krakend-jose/signer": {
            "alg": "HS256",
            "kid": "sim2",
            "keys-to-sign": ["access_token"],
            "jwk-url": "https://run.mocky.io/v3/a433e92c-6f25-4981-a7e5-4b710efc1e8e",
            "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "method": "GET",
          "host": [ "https://run.mocky.io" ],
          "url_pattern": "/v3/71606706-fd49-4a1a-abf4-bf4d0d883781"
        }
      ]
    },
    {
      "endpoint": "api/get-user/{userEid}",
      "method": "GET",
      "output_encoding": "no-op",
      "concurrent_calls": 1,
      "headers_to_pass": [ "Authorization" , "cookie" ],
      "querystring_params": [],
      "backend": [
        {
          "method": "GET",
          "host": [ "https://trunk-mysql.nightly.sakaiproject.org" ],
          "url_pattern": "/direct/session/becomeuser/{userEid}.json",
          "encoding": "no-op",
          "extra_config": {
            "github.com/devopsfaith/krakend/transport/http/client/executor": {
              "name": "clientPlugin",
              "conf": "/etc/krakend/plugins/plugin-conf.json"
            }
          }    
        }
      ]
    },
    {
      "endpoint": "api/current",
      "method": "GET",
      "extra_config": {},
      "headers_to_pass": [ "Authorization" , "cookie" ],
      "querystring_params": [],
      "backend": [
        {
          "method": "GET",
          "host": [ "https://trunk-mysql.nightly.sakaiproject.org" ],
          "url_pattern": "/direct/user/current.json",
          "whitelist": ["id","displayId"],
          "extra_config": {
            "github.com/devopsfaith/krakend/transport/http/client/executor": {
              "name": "clientPlugin",
              "conf": "/etc/krakend/plugins/plugin-conf.json"
            }
          }    
        },
        {
          "method": "GET",
          "host": [ "https://trunk-mysql.nightly.sakaiproject.org" ],
          "url_pattern": "/direct/membership.json",
          "blacklist": ["entityPrefix"],
          "extra_config": {
            "github.com/devopsfaith/krakend/transport/http/client/executor": {
              "name": "clientPlugin",
              "conf": "/etc/krakend/plugins/plugin-conf.json"
            },
            "github.com/devopsfaith/krakend/proxy": {
              "flatmap_filter": [
                  {
                      "type": "del",
                      "args": ["membership_collection.*.entityId"]
                  },
                  {
                    "type": "del",
                    "args": ["membership_collection.*.entityReference"]
                  }
              ]
            }
          }        
        }
      ]
    }

  ]
}
